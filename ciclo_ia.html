<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mi Ciclo Sagrado</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,700;1,400&amp;family=Playfair+Display:wght@400;700&amp;display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILOS GENERALES Y PALETA DE COLORES --- */
        :root {
            --color-menstrual-bg: #4a2a3a; /* Rojo carmín oscuro / berenjena */
            --color-menstrual-text: #fce4ec;
            --color-folicular-bg: #fdf6e6; /* Blanco hueso, cremoso */
            --color-folicular-text: #6d4c41;
            --color-ovulatoria-bg: #ffe0b2; /* Durazno suave */
            --color-ovulatoria-text: #d32f2f;
            --color-lutea-bg: #d1c4e9;   /* Violeta suave */
            --color-lutea-text: #311b92;
            
            --primary-bg: #fdf8f4; /* Fondo general muy suave */
            --text-color: #4e4248;
            --soft-black: #2c2c2c;
            --violet: #8e44ad;
            --pink: #e91e63;
            
            --font-title: 'Playfair Display', serif;
            --font-body: 'Lora', serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--primary-bg);
            color: var(--text-color);
            transition: background-color 0.5s ease;
        }

        /* --- ESTRUCTURA DE PANTALLAS --- */
        .screen {
            display: none;
            min-height: calc(100vh - 70px); /* Restar altura del nav */
            padding: 20px 25px 90px 25px; /* Padding inferior para no tapar con nav */
        }
        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- BARRA DE NAVEGACIÓN INFERIOR --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #eee;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            padding: 0 5px; /* Pequeño padding para que no se peguen a los bordes */
        }
        .nav-btn {
            background: none;
            border: none;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 9px; /* Reducido para que quepan más botones */
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s, transform 0.3s;
            flex: 1; /* Para que ocupen el espacio equitativamente */
            text-align: center;
        }
        .nav-btn.active {
            opacity: 1;
            transform: scale(1.1);
            color: var(--violet);
        }
        .nav-btn svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        /* --- ELEMENTOS DE UI REUTILIZABLES --- */
        h1, h2, h3 {
            font-family: var(--font-title);
            color: var(--soft-black);
            text-align: center;
        }
        h1 { font-size: 2.2em; margin-bottom: 10px; }
        h2 { font-size: 1.8em; margin-bottom: 20px; }
        p { line-height: 1.7; margin-bottom: 15px; }

        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        .card::before { /* Símbolo espiral decorativo */
            content: ' spirales ';
            font-family: 'Times New Roman', Times, serif; /* Placeholder for a symbol font */
            position: absolute;
            bottom: -20px;
            right: -20px;
            font-size: 80px;
            opacity: 0.05;
            color: var(--violet);
            transform: rotate(-30deg);
        }
        
        .btn-primary {
            display: block;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(45deg, var(--violet), var(--pink));
            color: white;
            font-family: var(--font-body);
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 68, 173, 0.4);
        }
        
        /* --- ESTILOS PANTALLA DE INICIO (MAPA EMOCIONAL) --- */
        #home-screen .phase-card {
            text-align: center;
            transition: all 0.5s ease;
        }
        #home-screen .archetype-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }
        #home-screen .archetype-name {
            font-family: var(--font-title);
            font-size: 2em;
            margin-bottom: 5px;
        }
        #home-screen .phase-name {
            font-style: italic;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        #home-screen .day-info {
            font-size: 1.2em;
            font-weight: bold;
        }
        #home-screen .ai-assistant {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255,255,255,0.5);
            border-radius: 12px;
            border: 1px dashed var(--violet);
        }
        #home-screen .ai-assistant p { margin-bottom: 0; font-style: italic;}

        /* --- ESTILOS DIARIO CÍCLICO --- */
        #journal-screen .journal-entry {
            margin-bottom: 20px;
        }
        #journal-screen textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: var(--font-body);
            font-size: 16px;
            resize: vertical;
        }
        #journal-screen label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
        }
        #journal-history .entry {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 5px solid;
        }
        #journal-history .entry-header { font-weight: bold; }

        /* --- ESTILOS RUEDA DEL CICLO --- */
        #wheel-screen .wheel-container {
            padding: 20px;
        }
        #wheel-screen .wheel-item {
            margin-bottom: 15px;
        }
        #wheel-screen label {
            display: block;
            margin-bottom: 5px;
        }
        #wheel-screen input[type="range"] {
            width: 100%;
        }

        /* --- ESTILOS CONFIGURACIÓN --- */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        /* --- MODO TERNURA --- */
        #tenderness-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 44, 44, 0.9);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        #tenderness-modal .content {
            background: var(--primary-bg);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        #tenderness-modal .content p {
            font-size: 1.2em;
            margin-bottom: 25px;
            color: var(--soft-black);
        }
        #tenderness-modal .close-btn {
            background: var(--violet);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        .tenderness-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--pink);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* --- PANTALLA DE BIENVENIDA / ONBOARDING --- */
        #onboarding-screen {
            display: flex; /* Se muestra por defecto */
            flex-direction: column;
            justify-content: center;
            text-align: center;
            height: 100vh;
            padding: 30px;
            background: linear-gradient(180deg, var(--lutea-bg), var(--primary-bg));
        }

        /* --- RITUAL INICIO DE CICLO --- */
        #ritual-modal {
             position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--menstrual-bg);
            color: var(--menstrual-text);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 30px;
            text-align: center;
        }
        #ritual-modal h2, #ritual-modal p {
            color: var(--menstrual-text);
        }
        #ritual-modal .ritual-icon { font-size: 50px; margin-bottom: 20px; }

    </style>
<style type="text/css">
.grande { font-size: 60px; }
</style>
<script>
// Escribir aqui el código Javascript
</script>
</head>
<body>

    <!-- PANTALLA DE BIENVENIDA (SOLO LA PRIMERA VEZ) -->
    <div id="onboarding-screen" class="screen active" style="display: flex;">
        <h1>Bienvenida a<br>Mi Ciclo Sagrado</h1>
        <p style="margin-top: 20px;">Un espacio para conectar contigo, tu cuerpo y tu energía cíclica.</p>
        <div class="form-group">
            <label for="onboarding-last-period">¿Cuándo fue el primer día de tu última menstruación?</label>
            <input type="date" id="onboarding-last-period">
        </div>
        <div class="form-group">
            <label for="onboarding-cycle-length">¿Cuánto dura tu ciclo usualmente? (días)</label>
            <input type="number" id="onboarding-cycle-length" value="28" min="15" max="60">
        </div>
        <button id="start-app-btn" class="btn-primary">Comenzar mi viaje</button>
    </div>

    <!-- CONTENIDO PRINCIPAL DE LA APP -->
    <div id="main-app" style="display: none;">
        <!-- 1. PANTALLA DE INICIO / MAPA EMOCIONAL -->
        <div id="home-screen" class="screen">
            <div id="phase-card-container">
                <!-- El contenido de la tarjeta se genera con JS -->
            </div>
            <div class="card ai-assistant">
                <p><strong>Voz Interior Sabia:</strong> <span id="ai-message"></span></p>
            </div>
        </div>

        <!-- 2. PANTALLA DE DIARIO CÍCLICO -->
        <div id="journal-screen" class="screen">
            <h2>Diario Cíclico</h2>
            <div class="card">
                <p><strong>Hoy es el día <span id="journal-day"></span> de tu ciclo.</strong> Estás en tu fase <span id="journal-phase"></span>.</p>
                <div id="journal-questions">
                    <!-- Las preguntas se generan con JS -->
                </div>
                <button id="save-journal-btn" class="btn-primary">Guardar mi sentir</button>
            </div>
            <h3>Mi Historial</h3>
            <div id="journal-history">
                <!-- Las entradas guardadas se muestran aquí -->
            </div>
        </div>

        <!-- 3. PANTALLA DE RUTINAS -->
        <div id="routines-screen" class="screen">
            <h2>Autocuidado para tu fase <span id="routines-phase-name"></span></h2>
            <div id="routines-content">
                <!-- El contenido de las rutinas se genera con JS -->
            </div>
        </div>
        
        <!-- 4. PANTALLA RUEDA DEL CICLO (SIMPLIFICADO) -->
        <div id="wheel-screen" class="screen">
            <h2>Mi Rueda de Hoy</h2>
            <p>Registra cómo te sientes hoy en una escala del 1 al 10.</p>
            <div class="card wheel-container">
                 <div class="wheel-item">
                    <label for="physical-state">🌿 Energía Física</label>
                    <input type="range" id="physical-state" min="1" max="10" value="5">
                </div>
                <div class="wheel-item">
                    <label for="emotional-state">💗 Estado Emocional</label>
                    <input type="range" id="emotional-state" min="1" max="10" value="5">
                </div>
                <div class="wheel-item">
                    <label for="mental-state">🧠 Claridad Mental</label>
                    <input type="range" id="mental-state" min="1" max="10" value="5">
                </div>
                 <div class="wheel-item">
                    <label for="intuition-state">✨ Conexión Intuitiva</label>
                    <input type="range" id="intuition-state" min="1" max="10" value="5">
                </div>
            </div>
        </div>

        <!-- 6. PANTALLA DE ANÁLISIS (Simplificado) -->
        <div id="analysis-screen" class="screen">
            <h2>Mis Patrones Cíclicos</h2>
            <div id="analysis-content" class="card">
                <p>Aquí verás tus patrones a medida que vayas registrando tus días. Aún no hay suficientes datos.</p>
            </div>
        </div>

        <!-- 7. PANTALLA DE CONFIGURACIÓN -->
        <div id="settings-screen" class="screen">
            <h2>Configuraciones</h2>
            <div class="card">
                <div class="form-group">
                    <label for="setting-last-period">Fecha de último periodo:</label>
                    <input type="date" id="setting-last-period">
                </div>
                <div class="form-group">
                    <label for="setting-cycle-length">Duración del ciclo (días):</label>
                    <input type="number" id="setting-cycle-length">
                </div>
                <button id="save-settings-btn" class="btn-primary">Guardar Cambios</button>
                <button id="reset-app-btn" style="background: #ccc; margin-top: 10px;" class="btn-primary">Reiniciar App</button>
            </div>
        </div>
        
        <!-- ================================== -->
        <!-- ==  NUEVAS PANTALLAS INTEGRADAS  == -->
        <!-- ================================== -->
        <div id="meditations-screen" class="screen">
            <h2>Meditaciones Guiadas</h2>
            <div class="card">
                <h3>Meditación para la Fase Actual: <span id="meditation-phase-name">Fase Menstrual</span></h3>
                <p>Una meditación especial para conectar con la energía de tu fase. Encuentra un lugar cómodo, cierra los ojos y pulsa play.</p>
                <audio controls="" style="width: 100%;">
                    <!-- Aquí se podría cargar un audio dinámicamente con JS -->
                    <source src="" type="audio/mpeg">
                    Tu navegador no soporta audio.
                </audio>
            </div>
            <div class="card">
                <h3>Respiración para calmar la mente</h3>
                <p>Inhala contando hasta 4, sostén la respiración contando hasta 4, exhala contando hasta 6. Repite 10 veces.</p>
            </div>
        </div>

        <div id="wisdom-screen" class="screen">
            <h2>Sabiduría Cíclica</h2>
            <div class="card">
                <h3>Los Arquetipos</h3>
                <p>Tu ciclo se divide en 4 arquetipos: La Bruja (Menstrual), La Doncella (Folicular), La Madre (Ovulatoria) y La Hechicera (Lútea). Cada una te trae dones y poderes únicos. Conocerlas es conocerte.</p>
            </div>
             <div class="card">
                <h3>La Luna y tu Ciclo</h3>
                <p>Muchas mujeres sienten una conexión entre su ciclo y las fases lunares. El "Ciclo de la Luna Blanca" es cuando menstruas en luna nueva y ovulas en luna llena. El "Ciclo de la Luna Roja" es al revés. Ninguno es mejor que otro, solo son energías diferentes.</p>
            </div>
        </div>

        <div id="inspiration-screen" class="screen">
            <h2>Inspiración del Día</h2>
             <div class="card">
                <h3>Frase para Hoy</h3>
                <p style="font-size: 1.5em; text-align: center; font-style: italic;">"Honro mi cuerpo como un templo sagrado y escucho sus susurros con amor."</p>
            </div>
             <div class="card">
                <h3>Acción Consciente</h3>
                <p>Hoy, regálate 5 minutos de silencio. Sin celular, sin distracciones. Solo tú y tu respiración. Observa qué pensamientos o sensaciones llegan, sin juzgarlos. Simplemente sé testigo de tu propio ser.</p>
            </div>
        </div>
        <!-- ================================== -->
        <!-- ==   FIN NUEVAS PANTALLAS       == -->
        <!-- ================================== -->


        <!-- 8. BOTÓN MODO TERNURA -->
        <button class="tenderness-btn" id="activate-tenderness-btn">💗</button>
        
        <!-- NAVEGACIÓN INFERIOR -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-screen="home-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>
                Inicio
            </button>
            <button class="nav-btn" data-screen="journal-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"></path></svg>
                Diario
            </button>
            
            <!-- ================================== -->
            <!-- ==   NUEVOS BOTONES INTEGRADOS   == -->
            <!-- ================================== -->
            <button class="nav-btn" data-screen="meditations-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M9 9.563C9 9.254 9.254 9 9.563 9h4.874c.309 0 .563.254.563.563v4.874c0 .309-.254.563-.563.563H9.563A.562.562 0 019 14.437V9.564z"></path></svg>
                Meditar
            </button>
            <button class="nav-btn" data-screen="inspiration-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"></path></svg>
                Inspiración
            </button>
            <button class="nav-btn" data-screen="wisdom-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path></svg>
                Sabiduría
            </button>
            <!-- ================================== -->
            <!-- ==     FIN NUEVOS BOTONES       == -->
            <!-- ================================== -->

            <button class="nav-btn" data-screen="routines-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"></path></svg>
                Cuidados
            </button>
             <button class="nav-btn" data-screen="analysis-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.517l2.74-1.22m0 0l-3.94-3.94m3.94 3.94l-3.94 3.94"></path></svg>
                Análisis
            </button>
            <button class="nav-btn" data-screen="settings-screen">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.438.995s.145.755.438.995l1.003.827c.446.368.524 1.06.164 1.431l-1.296-2.247a1.125 1.125 0 01-1.37.49l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.333.183-.582.495-.645.87l-.213 1.28c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.645-.87a6.52 6.52 0 01-.22-.127c-.324-.196-.72-.257-1.075-.124l-1.217.456a1.125 1.125 0 01-1.37-.49l-1.296-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.437-.995s-.145-.755-.437-.995l-1.004-.827a1.125 1.125 0 01-.164-1.431l1.296-2.247a1.125 1.125 0 011.37-.49l1.217.456c.355.133.75.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.645-.87l.213-1.28z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                Ajustes
            </button>
        </nav>
    </div>

    <!-- MODAL MODO TERNURA -->
    <div id="tenderness-modal">
        <div class="content">
            <p id="tenderness-message">Respira profundo. Estás a salvo. Todo está bien. Pon una mano en tu corazón y siente tu latido. Estás aquí, estás viva.</p>
            <button id="close-tenderness-btn" class="close-btn">Estoy más tranquila</button>
        </div>
    </div>
    
    <!-- MODAL RITUAL DE INICIO -->
    <div id="ritual-modal">
        <div class="ritual-icon">🩸</div>
        <h2>El Regreso a Mí</h2>
        <p>Tu ciclo ha comenzado. Es un momento de soltar, de rendirte, de volver a tu cueva interior. Hoy, honra tu descanso. Permítete ser, sin hacer. Tu cuerpo es sabio.</p>
        <p style="margin-top: 20px; font-style: italic;">"Suelto lo que ya no me sirve para hacer espacio a lo nuevo."</p>
        <button id="close-ritual-btn" class="btn-primary" style="margin-top: 30px;">Comenzar este ciclo con amor</button>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- ESTADO DE LA APLICACIÓN Y DATOS ---
        let state = {
            lastPeriodDate: null,
            cycleLength: 28,
            journalEntries: [],
            // ... otros datos como rueda, etc.
        };

        const phaseData = {
            menstrual: {
                name: "Menstrual",
                archetype: "La Bruja / La Anciana Sabia",
                icon: "🔮",
                colors: { bg: 'var(--color-menstrual-bg)', text: 'var(--color-menstrual-text)' },
                info: "Fase de introspección y descanso. Tu energía se dirige hacia adentro. Es tiempo de soltar, meditar y escuchar tu intuición.",
                ai_messages: [
                    "Recuerda ser amable contigo hoy. Tu cuerpo está trabajando mucho. El descanso no es un lujo, es una necesidad.",
                    "¿Qué necesitas soltar en este ciclo? Permítete sentir sin juzgar. Estás renovándote.",
                    "Como la luna nueva, es un tiempo de oscuridad fértil. Confía en el vacío."
                ],
                journal_questions: [
                    { id: 'emotion', label: '¿Qué emoción predomina en mí hoy?' },
                    { id: 'body', label: '¿Qué me dice mi cuerpo? ¿Dónde siento la energía?' },
                    { id: 'let_go', label: '¿Qué estoy lista para soltar en este nuevo ciclo?' }
                ],
                routines: {
                    alimentacion: "Alimentos ricos en hierro y magnesio: legumbres, espinacas, chocolate negro. Infusiones calientes como jengibre o canela.",
                    movimiento: "Movimientos suaves: estiramientos, yoga restaurativo, caminar lento en la naturaleza. Evita el ejercicio intenso.",
                    descanso: "Prioriza el sueño. Siestas si es posible. Reduce estímulos externos y agenda social.",
                    simbolico: "Escribe en tu diario, medita, toma un baño caliente con sales. Ritual de soltar: escribe lo que dejas ir y quémalo (con cuidado)."
                }
            },
            folicular: {
                name: "Folicular (Pre-ovulatoria)",
                archetype: "La Doncella / La Virgen",
                icon: "🌱",
                colors: { bg: 'var(--color-folicular-bg)', text: 'var(--color-folicular-text)' },
                info: "Tu energía y optimismo renacen. Es una fase de nuevos comienzos, planificación y creatividad. Tu mente está clara y receptiva.",
                 ai_messages: [
                    "Tu energía está despertando. ¿Qué nueva semilla quieres plantar esta semana? Aprovecha este impulso.",
                    "Es un gran momento para aprender algo nuevo o iniciar ese proyecto que tienes en mente. Tu mente está brillante.",
                    "Como la primavera, estás floreciendo. Sal al mundo, socializa, ¡disfruta de tu vitalidad!"
                ],
                journal_questions: [
                    { id: 'emotion', label: '¿Qué me inspira y me da energía hoy?' },
                    { id: 'body', label: '¿Cómo se siente mi cuerpo al despertar? ¿Está más ligero?' },
                    { id: 'intention', label: '¿Qué intención siembro para este ciclo?' }
                ],
                routines: {
                    alimentacion: "Alimentos frescos y ligeros: ensaladas, germinados, frutas. Proteínas para construir energía.",
                    movimiento: "Aumenta la intensidad: senderismo, baile, running, clases de fitness. Tu cuerpo tiene más resistencia.",
                    descanso: "Mantén una buena higiene del sueño para sostener tu energía creciente.",
                    simbolico: "Haz un mapa de sueños, planifica tus próximas semanas, prueba un nuevo hobby, sal a tomar un café con amigas."
                }
            },
            ovulatoria: {
                name: "Ovulatoria",
                archetype: "La Madre / La Amante",
                icon: "🌸",
                colors: { bg: 'var(--color-ovulatoria-bg)', text: 'var(--color-ovulatoria-text)' },
                info: "El pico de tu energía vital. Te sientes radiante, sociable y empática. Es un momento ideal para conectar, comunicar y expresar tu amor.",
                 ai_messages: [
                    "Hoy brillas con una luz especial. Es un día perfecto para conectar con otros y compartir tu corazón.",
                    "Tu capacidad de comunicación está en su punto más alto. Es un buen momento para conversaciones importantes.",
                    "Celebra tu cuerpo y tu sensualidad. Eres la expresión plena de la vida en este momento."
                ],
                journal_questions: [
                    { id: 'emotion', label: '¿Cómo expreso mi amor y gratitud hoy?' },
                    { id: 'body', label: '¿Cómo siento mi sensualidad y mi poder de creación?' },
                    { id: 'connection', label: '¿Con quién o qué me siento más conectada hoy?' }
                ],
                routines: {
                    alimentacion: "Alimentos ricos en antioxidantes: frutos rojos, verduras de hoja verde. Mantente bien hidratada.",
                    movimiento: "Actividades de alta energía y en comunidad: clases de baile en grupo, deportes de equipo, cardio intenso.",
                    descanso: "Tu energía es alta, pero no te olvides de descansar para no agotarte.",
                    simbolico: "Organiza una cena con amigos, ten una cita romántica, trabaja en proyectos colaborativos, habla en público."
                }
            },
            lutea: {
                name: "Lútea (Pre-menstrual)",
                archetype: "La Hechicera / La Chamana",
                icon: "🔥",
                colors: { bg: 'var(--color-lutea-bg)', text: 'var(--color-lutea-text)' },
                info: "La energía comienza a descender. Tu foco se vuelve más interno y tu intuición se agudiza. Puedes sentir la necesidad de orden y de poner límites.",
                 ai_messages: [
                    "Tu intuición está muy aguda ahora. Presta atención a tus corazonadas y sueños.",
                    "Es normal sentirte más sensible. Sé paciente contigo. Es un buen momento para poner límites amorosos.",
                    "Tu poder creativo se manifiesta de otra forma. Es ideal para terminar tareas, organizar tu espacio y reflexionar."
                ],
                journal_questions: [
                    { id: 'emotion', label: '¿Qué emociones están saliendo a la superficie?' },
                    { id: 'body', label: '¿Hay alguna tensión o cansancio? ¿Qué necesita mi cuerpo?' },
                    { id: 'intuition', label: '¿Qué verdad interior se está revelando?' }
                ],
                routines: {
                    alimentacion: "Alimentos que estabilizan el ánimo: carbohidratos complejos (avena, arroz integral), verduras de raíz. Reduce cafeína y azúcar.",
                    movimiento: "Reduce la intensidad. Pilates, yoga, natación suave. Actividades que te ayuden a liberar tensión.",
                    descanso: "Necesitas más descanso. Prioriza la relajación antes de dormir. Meditación, lectura.",
                    simbolico: "Limpia y organiza tu casa, haz una lista de tareas pendientes, escribe sin filtro, pasa tiempo a solas."
                }
            }
        };

        // --- ELEMENTOS DEL DOM ---
        const mainApp = document.getElementById('main-app');
        const onboardingScreen = document.getElementById('onboarding-screen');
        const startAppBtn = document.getElementById('start-app-btn');
        const screens = document.querySelectorAll('.screen');
        const navBtns = document.querySelectorAll('.nav-btn');
        
        // --- FUNCIONES PRINCIPALES ---

        function saveData() {
            localStorage.setItem('miCicloSagradoState', JSON.stringify(state));
        }

        function loadData() {
            const savedState = localStorage.getItem('miCicloSagradoState');
            if (savedState) {
                state = JSON.parse(savedState);
                return true;
            }
            return false;
        }

        function getCycleInfo() {
            if (!state.lastPeriodDate) return null;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const lastPeriod = new Date(state.lastPeriodDate);
            lastPeriod.setHours(0, 0, 0, 0);

            const diffTime = Math.abs(today - lastPeriod);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            
            const dayOfCycle = diffDays % state.cycleLength || state.cycleLength;

            let phaseKey = 'menstrual';
            // Simple model, can be refined
            const follicularStart = 6;
            const ovulatoryStart = Math.round(state.cycleLength / 2) - 2;
            const lutealStart = Math.round(state.cycleLength / 2) + 2;

            if (dayOfCycle >= follicularStart && dayOfCycle < ovulatoryStart) phaseKey = 'folicular';
            if (dayOfCycle >= ovulatoryStart && dayOfCycle < lutealStart) phaseKey = 'ovulatoria';
            if (dayOfCycle >= lutealStart) phaseKey = 'lutea';

            return {
                dayOfCycle,
                phase: phaseData[phaseKey]
            };
        }

        function updateUI() {
            const cycleInfo = getCycleInfo();
            if (!cycleInfo) return;
            
            updateHomePage(cycleInfo);
            updateJournalPage(cycleInfo);
            updateRoutinesPage(cycleInfo);
            updateAnalysisPage();
            updateMeditationsPage(cycleInfo);
            
            // Ritual de inicio
            if (cycleInfo.dayOfCycle === 1) {
                const ritualKey = 'ritualShownFor_' + state.lastPeriodDate;
                if (!localStorage.getItem(ritualKey)) {
                    document.getElementById('ritual-modal').style.display = 'flex';
                    localStorage.setItem(ritualKey, 'true');
                }
            }
        }
        
        function updateHomePage(cycleInfo) {
            const { dayOfCycle, phase } = cycleInfo;
            const container = document.getElementById('phase-card-container');
            const aiMessageEl = document.getElementById('ai-message');
            
            document.body.style.backgroundColor = phase.colors.bg;

            container.innerHTML = `
                <div class="card phase-card" style="background-color: ${phase.colors.bg}; color: ${phase.colors.text};">
                    <div class="archetype-icon">${phase.icon}</div>
                    <p class="day-info">Día ${dayOfCycle} de tu ciclo</p>
                    <h2 class="archetype-name">${phase.archetype}</h2>
                    <p class="phase-name">Fase ${phase.name}</p>
                    <p>${phase.info}</p>
                </div>
            `;
            
            const randomMsgIndex = Math.floor(Math.random() * phase.ai_messages.length);
            aiMessageEl.textContent = phase.ai_messages[randomMsgIndex];
        }
        
        function updateJournalPage(cycleInfo) {
            const { dayOfCycle, phase } = cycleInfo;
            document.getElementById('journal-day').textContent = dayOfCycle;
            document.getElementById('journal-phase').textContent = phase.name;
            
            const questionsContainer = document.getElementById('journal-questions');
            questionsContainer.innerHTML = '';
            phase.journal_questions.forEach(q => {
                questionsContainer.innerHTML += `
                    <div class="form-group">
                        <label for="journal-${q.id}">${q.label}</label>
                        <textarea id="journal-${q.id}"></textarea>
                    </div>
                `;
            });
            renderJournalHistory();
        }

        function renderJournalHistory() {
            const historyContainer = document.getElementById('journal-history');
            historyContainer.innerHTML = '';
            const recentEntries = state.journalEntries.slice(-5).reverse();
            if (recentEntries.length === 0) {
                historyContainer.innerHTML = '<p>Aún no tienes entradas en tu diario.</p>';
                return;
            }
            recentEntries.forEach(entry => {
                const phaseKey = Object.keys(phaseData).find(key => phaseData[key].name === entry.phaseName);
                const phaseColor = phaseKey ? phaseData[phaseKey].colors.bg : 'var(--primary-bg)';
                
                historyContainer.innerHTML += `
                    <div class="entry" style="border-color: ${phaseColor};">
                        <p class="entry-header">
                            <strong>${new Date(entry.date).toLocaleDateString()}:</strong>
                            Día ${entry.dayOfCycle}, Fase ${entry.phaseName}
                        </p>
                        <p><em>Emoción:</em> ${entry.answers.emotion || 'No registrado'}</p>
                        <p><em>Cuerpo:</em> ${entry.answers.body || 'No registrado'}</p>
                    </div>
                `;
            });
        }
        
        function updateRoutinesPage(cycleInfo) {
            const { phase } = cycleInfo;
            document.getElementById('routines-phase-name').textContent = phase.name;
            const contentContainer = document.getElementById('routines-content');
            contentContainer.innerHTML = `
                <div class="card">
                    <h3>🌿 Alimentación</h3>
                    <p>${phase.routines.alimentacion}</p>
                </div>
                <div class="card">
                    <h3>🤸‍♀️ Movimiento</h3>
                    <p>${phase.routines.movimiento}</p>
                </div>
                 <div class="card">
                    <h3>🌙 Descanso y Ser</h3>
                    <p>${phase.routines.descanso}</p>
                </div>
                <div class="card">
                    <h3>✨ Ritual Simbólico</h3>
                    <p>${phase.routines.simbolico}</p>
                </div>
            `;
        }
        
        function updateAnalysisPage() {
            const container = document.getElementById('analysis-content');
            if (state.journalEntries.length < 5) {
                container.innerHTML = '<p>Sigue registrando tus días para descubrir tus patrones sagrados. Necesitas al menos 5 entradas.</p>';
                return;
            }
            
            let creativityDays = new Set();
            let lowEnergyDays = new Set();
            state.journalEntries.forEach(entry => {
                const answer = (entry.answers.emotion || '').toLowerCase();
                if (answer.includes('creativa') || answer.includes('inspirada')) {
                    creativityDays.add(`Día ${entry.dayOfCycle} (${entry.phaseName})`);
                }
                if (answer.includes('cansada') || answer.includes('bajón')) {
                    lowEnergyDays.add(`Día ${entry.dayOfCycle} (${entry.phaseName})`);
                }
            });
            
            container.innerHTML = `
                <h4>Tus Patrones Observados:</h4>
                <p><strong>Días de alta creatividad/inspiración:</strong> ${[...creativityDays].join(', ') || 'Aún por descubrir'}</p>
                <p><strong>Días de energía más baja/introspección:</strong> ${[...lowEnergyDays].join(', ') || 'Aún por descubrir'}</p>
                <p style="margin-top: 15px; font-style: italic;">Con el tiempo, estos patrones se volverán más claros, revelando el mapa único de tu energía.</p>
            `;
        }

        function updateMeditationsPage(cycleInfo) {
            const { phase } = cycleInfo;
            document.getElementById('meditation-phase-name').textContent = phase.name;
            // Aquí podrías añadir lógica para cambiar el src del audio
        }

        function showScreen(screenId) {
            screens.forEach(screen => {
                screen.classList.remove('active');
                if (screen.id === screenId) {
                    screen.style.display = 'block';
                    // Pequeño delay para que la animación de fadeIn se active correctamente
                    setTimeout(() => screen.classList.add('active'), 10);
                } else {
                    screen.style.display = 'none';
                }
            });
            navBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.screen === screenId);
            });
            window.scrollTo(0, 0); // Volver arriba al cambiar de pantalla
        }
        
        function initializeApp() {
            if (loadData() && state.lastPeriodDate) {
                onboardingScreen.style.display = 'none';
                mainApp.style.display = 'block';
                showScreen('home-screen');
                updateUI();
                
                document.getElementById('setting-last-period').value = state.lastPeriodDate;
                document.getElementById('setting-cycle-length').value = state.cycleLength;

            } else {
                onboardingScreen.style.display = 'flex';
                mainApp.style.display = 'none';
            }
        }

        // --- EVENT LISTENERS ---
        
        startAppBtn.addEventListener('click', () => {
            const lastPeriod = document.getElementById('onboarding-last-period').value;
            const cycleLength = document.getElementById('onboarding-cycle-length').value;

            if (!lastPeriod || !cycleLength) {
                alert('Por favor, completa ambos campos para comenzar.');
                return;
            }

            state.lastPeriodDate = lastPeriod;
            state.cycleLength = parseInt(cycleLength);
            state.journalEntries = []; // Reset journal on new start
            saveData();
            initializeApp();
        });

        navBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const screenId = btn.dataset.screen;
                showScreen(screenId);
            });
        });
        
        document.getElementById('save-journal-btn').addEventListener('click', () => {
            const cycleInfo = getCycleInfo();
            const entry = {
                date: new Date().toISOString(),
                dayOfCycle: cycleInfo.dayOfCycle,
                phaseName: cycleInfo.phase.name,
                answers: {}
            };
            
            cycleInfo.phase.journal_questions.forEach(q => {
                const element = document.getElementById(`journal-${q.id}`);
                entry.answers[q.id] = element.value;
                element.value = ''; // Limpiar campos
            });
            
            state.journalEntries.push(entry);
            saveData();
            alert('Tu sentir ha sido guardado con amor.');
            renderJournalHistory();
        });

        document.getElementById('save-settings-btn').addEventListener('click', () => {
            state.lastPeriodDate = document.getElementById('setting-last-period').value;
            state.cycleLength = parseInt(document.getElementById('setting-cycle-length').value);
            saveData();
            alert('Configuración guardada.');
            updateUI();
            showScreen('home-screen');
        });

        document.getElementById('reset-app-btn').addEventListener('click', () => {
            if (confirm('¿Estás segura de que quieres borrar todos tus datos y reiniciar la app? Esta acción no se puede deshacer.')) {
                localStorage.clear();
                location.reload();
            }
        });
        
        // Modo Ternura
        document.getElementById('activate-tenderness-btn').addEventListener('click', () => {
            document.getElementById('tenderness-modal').style.display = 'flex';
        });
        document.getElementById('close-tenderness-btn').addEventListener('click', () => {
            document.getElementById('tenderness-modal').style.display = 'none';
        });

        // Ritual
        document.getElementById('close-ritual-btn').addEventListener('click', () => {
            document.getElementById('ritual-modal').style.display = 'none';
        });
        
        // --- INICIALIZACIÓN ---
        initializeApp();
    });
    </script>













</body></html>